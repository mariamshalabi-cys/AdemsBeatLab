// Car Information
const car = {
    make: "Ford",
    model: "Mustang GT",
    year: 2015,
    color: "Triple Yellow",
    horsepower: "460 HP",
    nickname: "Peely"
};

function displayCarInfo() {
    const carInfoDiv = document.getElementById('car-info');
    carInfoDiv.innerHTML = `
        <p><strong>Make:</strong> ${car.make}</p>
        <p><strong>Model:</strong> ${car.model}</p>
        <p><strong>Year:</strong> ${car.year}</p>
        <p><strong>Color:</strong> ${car.color}</p>
        <p><strong>Power:</strong> ${car.horsepower}</p>
        <p><strong>My Favorite Ride:</strong> ${car.nickname}</p>
    `;
}

// Global variables for the beat sequencer
const beatSequence = [];
const sounds = {};
let isPlaying = false;
let currentStep = 0;
let playbackInterval;

function loadSounds() {
    const soundButtons = document.querySelectorAll('.beat-button');
    soundButtons.forEach(button => {
        const soundFileName = button.dataset.sound;
        if (soundFileName) {
            sounds[button.id] = new Audio(`sounds/${soundFileName}`);
            sounds[button.id].load();
        }
    });
}

function playSound(buttonId) {
    if (sounds[buttonId]) {
        sounds[buttonId].currentTime = 0;
        sounds[buttonId].play().catch(e => console.error("Error playing sound:", e));
    }
}

function addToSequence(buttonId) {
    beatSequence.push(buttonId);
    console.log("Current sequence:", beatSequence);
    updateMessage(`Added sound to sequence. Sequence length: ${beatSequence.length}`);
}

function playSequence() {
    if (isPlaying) {
        clearInterval(playbackInterval);
        isPlaying = false;
        updateMessage("Beat stopped.");
        return;
    }

    if (beatSequence.length === 0) {
        updateMessage("Sequence is empty. Add some sounds first!");
        return;
    }

    isPlaying = true;
    currentStep = 0;
    updateMessage("Playing beat...");

    playbackInterval = setInterval(() => {
        if (currentStep < beatSequence.length) {
            const buttonId = beatSequence[currentStep];
            playSound(buttonId);
            currentStep++;
        } else {
            clearInterval(playbackInterval);
            isPlaying = false;
            updateMessage("Beat finished.");
        }
    }, 500);
}

function clearSequence() {
    beatSequence.length = 0;
    if (isPlaying) {
        clearInterval(playbackInterval);
        isPlaying = false;
    }
    updateMessage("Beat sequence cleared.");
}

function updateMessage(message) {
    const messageArea = document.getElementById('message-area');
    messageArea.textContent = message;
}

function setupAllListeners() {
    const beatPadDiv = document.getElementById('beat-pad');
    beatPadDiv.addEventListener('click', (event) => {
        const clickedButton = event.target.closest('.beat-button');
        if (clickedButton) {
            playSound(clickedButton.id);
            addToSequence(clickedButton.id);
        }
    });

    document.getElementById('playBtn').addEventListener('click', playSequence);
    document.getElementById('clearBtn').addEventListener('click', clearSequence);
}

document.addEventListener('DOMContentLoaded', () => {
    displayCarInfo();
    loadSounds();
    setupAllListeners();
});
